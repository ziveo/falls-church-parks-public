import{eV as N,aq as C,a9 as S,h as O,ds as R,aO as q,z as A,eW as B,eX as j}from"./index.a831a68c.js";import{O as k}from"./quantizationUtils.d707a317.js";import{T as G,s as Y,m as _,c as U,V as W,g as X,h as Z,y as H,D as J,z as K}from"./utils.af49be5e.js";import"./ClassBreaksDefinition.c9b8718c.js";let z=null;function L(e,a,l){return e.x<0?e.x+=a:e.x>l&&(e.x-=a),e}function Q(e,a,l,t){const i=N(l)?C(l):null,r=i?Math.round((i.valid[1]-i.valid[0])/a.scale[0]):null;return e.map(s=>{const n=new S(O(s.geometry));return k(a,n,n,n.hasZ,n.hasM),s.geometry=i?L(n,r,t[0]):n,s})}function aa(e,a=18,l,t,i,r){const s=new Float64Array(i*r);a=Math.round(A(a));let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,u=0,m=0,d=0,f=0;const c=B(t,l);for(const{geometry:v,attributes:I}of e){const{x:y,y:V}=v,E=Math.max(0,y-a),M=Math.max(0,V-a),g=Math.min(r,V+a),P=Math.min(i,y+a),$=+c(I);for(let x=M;x<g;x++)for(let T=E;T<P;T++){const F=x*i+T,b=j(T-y,x-V,a),D=s[F];u=s[F]+=b*$;const w=u-D;m+=w,d+=w*w,u<n&&(n=u),u>o&&(o=u),f++}}if(!f)return{mean:0,stddev:0,min:0,max:0,mid:0,count:0};const p=(o-n)/2;return{mean:m/f,stdDev:Math.sqrt((d-m*m/f)/f),min:n,max:o,mid:p,count:f}}async function h(e,a){if(!a)return[];const l=e.field,t=e.valueExpression,i=e.normalizationType,r=e.normalizationField,s=e.normalizationTotal,n=[],o=e.viewInfoParams;let u=null,m=null;if(t){if(!z){const{arcadeUtils:c}=await R();z=c}u=z.createFunction(t),m=o&&z.getViewInfo({viewingMode:o.viewingMode,scale:o.scale,spatialReference:new q(o.spatialReference)})}const d=e.fieldInfos,f=!(a[0]&&"declaredClass"in a[0]&&a[0].declaredClass==="esri.Graphic")&&d?{fields:d}:null;return a.forEach(c=>{const p=c.attributes;let v;if(t){const I=f?{...c,layer:f}:c,y=z.createExecContext(I,m);v=z.executeFunction(u,y)}else p&&(v=p[l]);if(i&&isFinite(v)){const I=p&&parseFloat(p[r]);v=G(v,i,I,s)}n.push(v)}),n}async function oa(e){const{attribute:a,features:l}=e,{normalizationType:t,normalizationField:i,minValue:r,maxValue:s,fieldType:n}=a,o=await h({field:a.field,valueExpression:a.valueExpression,normalizationType:t,normalizationField:i,normalizationTotal:a.normalizationTotal,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},l),u=Y({normalizationType:t,normalizationField:i,minValue:r,maxValue:s}),m={value:.5,fieldType:n},d=n==="esriFieldTypeString"?_({values:o,supportsNullCount:u,percentileParams:m}):U({values:o,minValue:r,maxValue:s,useSampleStdDev:!t,supportsNullCount:u,percentileParams:m});return W(d,n==="esriFieldTypeDate")}async function sa(e){const{attribute:a,features:l}=e,t=await h({field:a.field,valueExpression:a.valueExpression,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},l),i=X(t);return Z(i,a.domain,a.returnAllCodedValues)}async function la(e){const{attribute:a,features:l}=e,{field:t,normalizationType:i,normalizationField:r,normalizationTotal:s,classificationMethod:n}=a,o=await h({field:t,valueExpression:a.valueExpression,normalizationType:i,normalizationField:r,normalizationTotal:s,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},l),u=H(o,{field:t,normalizationType:i,normalizationField:r,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a.standardDeviationInterval,numClasses:a.numClasses,minValue:a.minValue,maxValue:a.maxValue});return J(u,n)}async function ra(e){const{attribute:a,features:l}=e,{field:t,normalizationType:i,normalizationField:r,normalizationTotal:s,classificationMethod:n}=a,o=await h({field:t,valueExpression:a.valueExpression,normalizationType:i,normalizationField:r,normalizationTotal:s,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},l);return K(o,{field:t,normalizationType:i,normalizationField:r,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a.standardDeviationInterval,numBins:a.numBins,minValue:a.minValue,maxValue:a.maxValue})}async function ua(e){const{attribute:a,features:l}=e,{field:t,radius:i,fieldOffset:r,transform:s,spatialReference:n,size:o}=a,u=Q(l,s,n,o),{count:m,min:d,max:f,mean:c,stdDev:p}=aa(u,i,r,t,o[0],o[1]);return{count:m,min:d,max:f,avg:c,stddev:p}}export{la as classBreaks,ua as heatmapStatistics,ra as histogram,oa as summaryStatistics,sa as uniqueValues};
